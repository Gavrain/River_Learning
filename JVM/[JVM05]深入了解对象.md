# [JVM05]深入了解对象结构

## **Header对象头**

HotSpot虚拟机的对象头包括两部分信息：

- 运行时数据
- 类型指针。

**运行时数据**（Mark Word）

用于存储对象自身的运行时数据，如哈希码（HashCode）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等。

根据虚拟机32位和64位的不同分别占用32位和64位。

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180411/a2EBa8chIJ.png?imageslim)

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180411/iLmf2F4jh6.png?imageslim)



**类型指针**

即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。

如果对象是一个Java数组，那**在对象头中还必须有一块用于记录数组长度的数**据，因为虚拟机可以通过普通Java对象的元数据信息确定Java对象的大小，但是从数组的元数据中无法确定数组的大小。 
(**并不是所有的虚拟机实现都必须在对象数据上保留类型指针，换句话说，查找对象的元数据并不一定要经过对象本身**，可参考对象的访问定位)

## **实例数据**(Instance Data)

**实例数据部分是对象真正存储的有效信息，也是在程序代码中所定义的各种类型的字段内容**。无论是从父类中继承下来的，还是在子类中定义的，都需要记录下来。HotSpot虚拟机默认的分配策略为longs/doubles、ints、shorts/chars、bytes/booleans、oop，从分配策略中可以看出，相同宽度的字段总是分配到一起。

## **对齐填充**(Padding)

HotSpot虚拟机要求对象的起始地址必须是8字节的整数倍，也就是对象的大小必须是8字节的整数倍。而对象头部分正好是8字节的倍数（1倍或者2倍），因此，当对象实例数据部分没有对齐的时候，就需要通过对齐填充来补全。

