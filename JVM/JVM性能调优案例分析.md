# JVM性能调优案例分析

## 1、经常有用户反映长时间出现卡顿

系统的配置

64G （堆内存设置的是50G）

centos

tomcat 7.0



这个时间点不是某一个固定的时间点

不是再某个功能上进行卡顿

- 处理的思路是
  - 如果是在某一个功能上卡顿的时间比较长，首先想到的就是优化sql
  - 监控线程（线程没有什么问题）和内存（内存的使用量也是正常的）
    - 发现经常出现FULL GC（大对象的创建会直接存储到老年代中）时间在20-30S，这就是发生卡顿的原因
    - 考核项的数据都是会封装到workbok这个对象里面，这个对象是非常大的，大对象是直接的放到老年代的
- 现在怎么处理性能上的瓶颈呢？
  - 首先想的是把堆内存改小一点，这样FULL GC的时间就短一点，但是这样多的内存不就是浪费了吗
  - 实际的解决方案是部署多个web容器，每个web容器的堆内存指定为4G,这样FULL GC的时间的比较快，而且多个web容器对外提供服务，NGINX负载的策略使用的ip Hash的策略

## 二、数据抓取系统

场景：简单的数据抓取系统，抓取的是网上的一些数据，分发到其他的应用上

环境： Windows server2003 JDK5  **2G内存**  Intel core i3

问题：不定期的内存溢出，把堆内存加也无济于事。导出堆转存快照信息，没有任何信息。内存监控正常

**处理思路**：NIO会出现分配堆外内存（**直接内存的问题**），堆外内存撑爆了，就导致了内存溢出（并不是JVM的内存溢出了而是系统的内存溢出了），把OutOfMemory改大一点就可以在2G的内存上的机器上进行稳定的运行了



## 三、物联网的应用

![1531210116111](C:\Users\huanghe\AppData\Local\Temp\1531210116111.png)

这个系统类似于我们的跌倒报警器，家庭应用和server端进行通信使用的是netty，通信服务器和web应用服务器之间的通信使用的是RabbitMQ

问题：两个服务器的JVM崩溃，Connect Reset ：连接重置

出现的问题的分析：长时间的运行就会在物理设备上和通信服务器之间积累了大量的未处理的数据，导致了连接异常，导致了JVM崩溃

问题的解决方式：中间加一个消息队列就可以了RabbitMQ,生产者消费者；

经验：处理不对等的数据的时候，需要使用消息队列的方式进行解决



