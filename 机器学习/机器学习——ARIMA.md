# 机器学习——ARIMA

[TOC]

## 平稳性

平稳性就是要求经由样本时间序列所得到的拟合曲线，在未来的一段时间内仍能顺着现有的形态“惯性”地延续下去

平稳性要求序列的均值和方差不发生明显的变化

严平稳：表示的是分布不随时间的改变而改变   如：白噪声（正态分布），无论怎么取，都是期望为0，方差为1

弱平稳：期望与相关系数（依赖性）不变，未来某时刻的t的值Xt的值就要依赖于它过去的信息，所以需要依赖性

实际的情况下拿到的数据集都是弱平稳的数据



## 差分法

**使得数据的平稳性更加好一些；**

差分法：时间序列在t与t-1时刻的差值



## 自回归模型AR

1. 描述当前值与历史值之间的关系，用变量自身的历史时间 数据对自身进行预测
2. 自回归模型必须满足平稳性的要求
3. p阶自回归过程的公式定义：$y_t=\mu +\sum_{i=1}^p \gamma_i y_{(t-i)}+\epsilon_t$
4. $y_t$表示的是当前值   $\mu$常数项   p是阶数  $\gamma_i$是自相关系数（相当于是权值）  $\epsilon_t$是误差



P的取值不是一下子就能看出来的，需要不断的进行评估才是可以得到的！



自回归模型的限制：

- 自回归模型是用自身的数据来进行预测的
- 必须具有平稳性
- 必须具有自相关性，如果自相关系数小于0.5，则不宜采用
- 自回归只适用于预测与自身前期相关的现象



 ## 移动平均模型MA

1. 移动平均模型关注的是自回归模型中的误差项的累积
2. q阶自回归的公式定义：$y_t=\mu+\epsilon_t+\sum_{i=1}^q \theta_i \epsilon_{(t-i)}$
3. 移动平均法能有效地消除预测中的随机波动



## 自回归移动平均模型ARMA

- 自回归与移动平均的结合
- 公式定义为：$y_t=\mu+\sum_{i=1}^p \gamma_i y_{(t-i)}+\epsilon_{t}+\sum_{i=1}^q \theta_i \epsilon_{(t-i)}$
- p和q越大的时候参数项就是越大的



##差分自回归移动平均模型ARIMA

1. ARIMA(p,d,q)模型全称为差分自回归移动平均模型（ARIMA）
2. AR是自回归，p为自回归项（也就是取前面多长时间）；MA为移动平均，q为移动平均项数，d为时间序列成为平稳时所做的差分次数
3. 原理：将非平稳时间序列转化为平稳时间序列然后将因变量仅对它的滞后值以及随机误差的现值和滞后值进行回归所建立的模型

## 自相关函数ACF

这个模型是帮助我们选择p的值和q的值的：

- 有序的随机变量序列与其自身相比较，自相关函数反应了同一序列在**不同时序**的取值之间的相关性
- 公式：$ACF（k）=p_k=\frac{Cov(y_t,y_{(t-k)})}{Var(y_t)}$
- pk的取值范围为[-1,1]![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180315/CGJklK68bj.png?imageslim)

## 偏自相关函数PACF

- 对于一个平稳AR(p)模型，求出滞后k自相关系数p(k)时实际上得到的并不是x(t)与x(t-k)之间单纯的相关关系
- x(t)同时还会受到中间k-1个随机变量x(t-1)、x(t-2)、.........x(t-k+1)的影响而这k-1个随机变量又都和x(t-k)具有相关关系，所以**自相关系数p(k)里实际掺杂了其他变量对x(t)与x(t-k)的影响**
- 剔除中间k-1个随机变量x(t-1)、x(t-2)、.........x(t-k+1)的影响之后，x(t-k)对x(t)影响的相关程度
- AFC还包含了其他变量的影响，而偏自相关系数PACF是严格的这两个变量之间的相关性





## ARIMA(p,d,q)阶数确定

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180315/gBfm3Ljd39.png?imageslim)

截尾：落到置信区间内（95%的点都符合该规则）

**AR(P)：观察的是PACF**

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180315/bE4hF2b01k.png?imageslim)

由图可以得出：在第二阶就已经落到了置信区间内了，所以q值取2就可以了



**MA(q):观察的是ACF**

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180315/3LI6i38IEf.png?imageslim)

由图可以得出q值为：



## 一个练习ARIMA(p.d.q)阶数的确定

![mark](http://ozxf77u6w.bkt.clouddn.com/blog/180315/D2iHFdjhK1.png?imageslim)

AR(p)看的是PACF:P阶截尾，ACF是衰减趋于0；所以这里p=1就可以了

MA(q):看的是ACF结尾，PACF衰减趋于0，所以这里的q=7就可以了   （额外冒出的点是奇异点）



## ARIMA建模的流程

1. 将序列平稳（差分法确定d）
2. p和q阶数确定：ACF和PACF
3. ARIMA(p,d,q)



## 参数的选择

在python中直接的可以掉用arima200=sm.tsa.SARIMAX(ts_train,order=(2,0,0))

model_results=arima.fit()

**order里面的数据就是p,d,q的数据**,**最重点的就是p,d,q**



## 模型的评估

模型选择AIC和BIC:选择更加简单的模型*（选择更好的p,d,q）

AIC:赤池信息准则（Akaike Information Criterion,AIC） AIC=2k-2ln(L)

**表达的意思就是参数和结果之间的权衡**，越低越好



BIC:贝叶斯信息准则  BIC=Kln(n)-2ln(L)



K位模型的参数个数，n为样本的数量，L为似然函数





## 模型残差检验

ARIMA模型的残差是否是平均值为0且方差为常数的正态分布

QQ图：线性即正态分布

​        





